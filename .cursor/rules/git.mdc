---
description: The Gatekeeper — Git commit & PR standards (Conventional Commits + enforceable hygiene)
globs: .git/**/*
---

# The Gatekeeper (Git & Commits)

## Goals
- Clean, searchable history
- Auto-generated changelogs/releases (when used)
- Faster reviews with consistent scopes
- Safe, revertable commits

---

## Commit Message Format (Strict)
Use **Conventional Commits**:

`type(scope)!: subject`

Optional:
- body (why + what changed)
- footer (breaking changes, issue refs)

Examples:
- `feat(auth): add otp verification`
- `fix(cart): prevent negative quantity`
- `refactor(shared-ui)!: replace button variants api`
- `chore(ci): add format check`

---

## Allowed Types (Strict List)
### Product / Code
- `feat` — new user-facing feature
- `fix` — bug fix
- `refactor` — code change that neither fixes a bug nor adds a feature
- `perf` — performance improvements
- `style` — formatting only (no behavior change)
- `test` — add or update tests

### Maintenance
- `docs` — documentation only
- `chore` — tooling, deps, repo maintenance
- `build` — build system changes (bundler, tsconfig, etc.)
- `ci` — CI pipeline changes
- `revert` — revert a previous commit

**Rule:** If none fit, use `chore`.

---

## Scopes (Standardized)
Scopes must be **kebab-case** and map to the repo structure.

Examples:
- Features: `auth`, `cart`, `checkout`, `user-profile`
- Shared: `shared-ui`, `shared-api`, `shared-lib`
- App composition: `app`, `routing`
- Tooling: `eslint`, `prettier`, `vitest`, `deps`, `ci`

**Rule:** Scope is required unless the change is truly global, then omit it:
- `docs: update contributing guide`

---

## Subject Line Rules (Hard)
- **Lowercase** subject (no sentence case)
- **Imperative** mood: “add”, “fix”, “remove”, “update”
- **No trailing period**
- **Max 72 chars** (50 is overly strict for modern scopes; 72 is standard)
- Must describe **what** changed, not “why”:
  - ✅ `fix(auth): handle expired refresh token`
  - ❌ `fix(auth): because login broke`

---

## Breaking Changes
Use `!` when a change breaks consumers:
- `feat(api)!: change user payload shape`

And add a footer:
- `BREAKING CHANGE: <one-line explanation>`

---

## Commit Body (When Required)
Add a body when:
- the change is non-trivial
- behavior changes
- tradeoffs/decisions matter

Body rules:
- Explain **why** + key decisions
- Prefer bullet points
- Mention migration notes if needed

---

## Issue / Ticket References
If your repo uses issues/tickets, add in footer:
- `Refs: #123`
- `Closes: #123`

---

## Atomicity Rules (Gatekeeper Checks)
- One commit = one logical change.
- Do not mix formatting with logic:
  - formatting-only goes in `style(...)`
- Do not mix refactors and features unless necessary.

---

## Reverts
Use `revert: ...` (auto-generated by Git is fine).
If manual:
- `revert(scope): <original subject>`

---

## Branch Naming (Recommended)
- `feat/<scope>-<short-desc>`
- `fix/<scope>-<short-desc>`
- `chore/<scope>-<short-desc>`

Examples:
- `feat/auth-otp`
- `fix/cart-quantity`

---

## PR Title = Commit Format (Required)
PR titles must follow the same Conventional Commit format.
Squash merges must use the PR title as the final commit message.

---

## Quick Examples
✅ Good:
- `feat(user-profile): add avatar upload`
- `fix(shared-api): retry 429 with backoff`
- `ci(prettier): fail on format violations`
- `test(auth): add token refresh coverage`

❌ Bad:
- `Added new feature`
- `Fix bug.`
- `updates`
- `feat: User Profile changes`

---

## Optional Enforcement (Highly Recommended)
- Commit-msg hook (commitlint) to enforce format
- PR checks to block non-compliant titles
- Squash-only merge to keep history clean